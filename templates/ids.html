{% extends "base.html" %}
{% block title %}ID Management | EMIS Portal{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ids.css') }}">

<div class="admin-dashboard fade-in">

  <!-- HEADER -->
  <div class="dash-header">
    <div>
      <h2>ID Management</h2>
      <p>Monitor and manage student & teacher IDs â€” generate, suspend, or sync with Supabase</p>
    </div>
    <div class="header-actions">
      <button id="generateTeacherBtn" class="btn-primary">
        <i class="fa-solid fa-user-tie"></i> Generate Teacher IDs
      </button>
      <button id="syncDataBtn" class="btn-secondary">
        <i class="fa-solid fa-rotate"></i> Sync Supabase
      </button>
    </div>
  </div>

  <!-- STATS GRID -->
  <div class="stat-grid">
    <div class="stat-card blue">
      <i class="fa-solid fa-users icon"></i>
      <div>
        <p>Total Students</p>
        <h2 id="totalStudents">--</h2>
      </div>
    </div>
    <div class="stat-card teal">
      <i class="fa-solid fa-user-tie icon"></i>
      <div>
        <p>Total Teachers</p>
        <h2 id="totalTeachers">--</h2>
      </div>
    </div>
    <div class="stat-card orange">
      <i class="fa-solid fa-id-card icon"></i>
      <div>
        <p>Last Generated</p>
        <h2 id="lastGenerated">--</h2>
      </div>
    </div>
    <div class="stat-card purple">
      <i class="fa-solid fa-database icon"></i>
      <div>
        <p>Last Sync</p>
        <h2 id="lastSync">--</h2>
      </div>
    </div>
  </div>

<!-- QUICK ID TOOLS -->
<div class="quick-modules">
  <div class="flex justify-between items-center">
    <div>
      <h3><i class="fa-solid fa-bolt text-accent"></i> Quick ID Tools</h3>
      <p class="sub-text">Access quick functions for managing and generating IDs</p>
    </div>

    <!-- âœ… View Buttons beside text -->
    <div class="flex items-center gap-3">
      <button id="viewTeacherIdsBtn" class="btn-primary flex items-center gap-2 px-3 py-2 rounded-md text-sm shadow-sm hover:bg-blue-700">
        <i class="fa-solid fa-user-tie"></i> View Teacher IDs
      </button>
      <button id="viewStudentIdsBtn" class="btn-secondary flex items-center gap-2 px-3 py-2 rounded-md text-sm shadow-sm hover:bg-teal-700">
        <i class="fa-solid fa-user-graduate"></i> View Student IDs
      </button>
    </div>
  </div>

  <!-- TOOL GRID -->
  <div class="modules-grid mt-5">
    <div class="module-item blue" data-action="generateTeacher">
      <i class="fa-solid fa-user-plus"></i>
      Student IDs
    </div>

    <div class="module-item teal" id="viewTeacherIds">
      <i class="fa-solid fa-user-tie"></i>
      Teacher IDs
    </div>

    <div class="module-item green" data-action="viewStudents">
      <i class="fa-solid fa-user-graduate"></i>
      Students
    </div>

    <div class="module-item orange" data-action="export">
      <i class="fa-solid fa-file-csv"></i>
      Export CSV
    </div>

    <div class="module-item purple" data-action="suspend">
      <i class="fa-solid fa-ban"></i>
      Suspend
    </div>

    <div class="module-item red" data-action="delete">
      <i class="fa-solid fa-trash"></i>
      Delete
    </div>

    <div class="module-item yellow" data-action="refresh">
      <i class="fa-solid fa-rotate"></i>
      Refresh
    </div>

    <div class="module-item pink" data-action="settings">
      <i class="fa-solid fa-gear"></i>
      Settings
    </div>
  </div>
</div>

  <!-- SEARCH + EXPORT -->
  <div class="search-export flex justify-between items-center mt-8 mb-3">
    <div class="flex items-center gap-3">
      <select id="viewSelector" class="selector">
        <option value="students">View Students</option>
        <option value="teachers">View Teachers</option>
      </select>
      <input type="text" id="searchBox" class="search-input" placeholder="Search by ID or name...">
    </div>
    <button id="exportCSVBtn" class="btn-secondary">
      <i class="fa-solid fa-file-csv"></i> Export CSV
    </button>
  </div>

  <!-- STUDENT TABLE -->
  <div id="studentSection" class="table-container fade-in">
    <h3 class="table-title"><i class="fa-solid fa-user-graduate text-accent"></i> Student IDs</h3>
    <table id="studentTable">
      <thead>
        <tr>
          <th>Student ID</th>
          <th>Full Name</th>
          <th>Class</th>
          <th>Date Registered</th>
        </tr>
      </thead>
      <tbody id="studentTableBody">
        <!-- Populated by JS -->
      </tbody>
    </table>
  </div>

  <!-- TEACHER TABLE -->
  <div id="teacherSection" class="table-container fade-in hidden">
    <h3 class="table-title"><i class="fa-solid fa-user-tie text-accent"></i> Teacher IDs</h3>
    <table id="teacherTable">
      <thead>
        <tr>
          <th>Teacher ID</th>
          <th>Password</th>
          <th>Status</th>
          <th>Date Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="teacherTableBody">
        <!-- Populated by JS -->
      </tbody>
    </table>
  </div>

<!-- =============== MODALS =============== -->

<!-- ðŸ”¹ Generate Teacher IDs Modal -->
<div id="generateTeacherModal" class="modal hidden fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-sm">
  <div class="modal-content bg-white rounded-2xl shadow-xl w-full max-w-md p-6 relative animate-fadeIn">
    <button id="closeGenerateModal"
      class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-red-500 hover:text-white transition">
      âœ•
    </button>
    <div class="text-center mb-5">
      <h3 class="text-xl font-semibold text-navy">
        <i class="fa-solid fa-user-tie text-accent"></i> Generate Teacher IDs
      </h3>
      <p class="text-sm text-gray-600 mt-1">Automatically create teacher login IDs and passwords.</p>
    </div>

    <form id="generateTeacherForm" class="space-y-4">
      <div>
        <label for="numTeachers" class="block text-sm font-medium text-gray-700 mb-1">
          Number of Teacher IDs to generate
        </label>
        <input type="number" id="numTeachers" min="1" max="100" placeholder="e.g. 5"
               class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600 focus:outline-none" required>
      </div>

      <div class="flex justify-between mt-4">
        <button type="submit" class="btn-primary flex items-center gap-2 px-4 py-2 rounded-md">
          <i class="fa-solid fa-bolt"></i> Generate
        </button>
        <button type="button" id="cancelGenerateBtn" class="btn-secondary flex items-center gap-2 px-4 py-2 rounded-md">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>


<!-- ðŸ”¹ Delete Confirmation Modal -->
<div id="deleteModal" class="modal hidden fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-sm">
  <div class="modal-content bg-white rounded-2xl shadow-xl w-full max-w-md p-6 relative animate-fadeIn">
    <button id="closeDeleteModal"
      class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-red-500 hover:text-white transition">
      âœ•
    </button>
    <h3 class="text-lg font-semibold text-red-600 mb-2">
      <i class="fa-solid fa-triangle-exclamation"></i> Confirm Deletion
    </h3>
    <p class="text-gray-600 mb-4">Are you sure you want to delete this teacher ID? This action cannot be undone.</p>
    <div class="flex justify-between">
      <button id="confirmDeleteBtn"
        class="btn-primary bg-red-600 hover:bg-red-700 flex items-center gap-2 px-4 py-2 rounded-md">
        <i class="fa-solid fa-trash"></i> Delete
      </button>
      <button id="cancelDeleteBtn" class="btn-secondary flex items-center gap-2 px-4 py-2 rounded-md">Cancel</button>
    </div>
  </div>
</div>


<!-- ðŸ”¹ Suspend Teacher Modal -->
<div id="suspendModal" class="modal hidden fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-sm">
  <div class="modal-content bg-white rounded-2xl shadow-xl w-full max-w-md p-6 relative animate-fadeIn">
    <button id="closeSuspendModal"
      class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-red-500 hover:text-white transition">
      âœ•
    </button>
    <h3 class="text-lg font-semibold text-orange-600 mb-2">
      <i class="fa-solid fa-ban"></i> Suspend Teacher ID
    </h3>
    <p class="text-gray-600 mb-4">Are you sure you want to suspend this teacherâ€™s access?</p>
    <div class="flex justify-between">
      <button id="confirmSuspendBtn"
        class="btn-primary bg-orange-500 hover:bg-orange-600 flex items-center gap-2 px-4 py-2 rounded-md">
        <i class="fa-solid fa-ban"></i> Suspend
      </button>
      <button id="cancelSuspendBtn" class="btn-secondary flex items-center gap-2 px-4 py-2 rounded-md">Cancel</button>
    </div>
  </div>
</div>


<!-- ðŸ”¹ Teacher IDs View Modal (New, Stylish) -->
<div id="teacherIdModal" class="cred-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="cred-container bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl w-full max-w-xl p-6 relative animate-fadeIn">

    <!-- Close -->
    <button id="closeTeacherIdModal"
      class="absolute top-3 right-3 w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-red-500 hover:text-white transition">
      âœ•
    </button>

    <!-- Header -->
    <div class="text-center mb-4">
      <h3 class="text-2xl font-semibold bg-gradient-to-r from-blue-700 to-indigo-600 text-transparent bg-clip-text">
        Teacher IDs Generated
      </h3>
      <p class="text-sm text-gray-600 mt-1">Below are the most recently created login credentials.</p>
    </div>

    <!-- Results -->
    <div id="teacherIdResults"
         class="space-y-3 max-h-[350px] overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>

    <!-- Footer -->
    <div class="flex justify-between items-center mt-5">
      <button id="downloadTeacherCSV"
        class="btn-secondary px-3 py-2 rounded-md text-sm bg-teal-600 hover:bg-teal-700 text-white">
        â¬‡ Download CSV
      </button>
      <button id="refreshTeacherList"
        class="btn-primary px-3 py-2 rounded-md text-sm bg-blue-700 hover:bg-blue-800 text-white">
        ðŸ”„ Refresh
      </button>
    </div>
  </div>
</div>


<!-- ðŸ”¹ Teacher ID Options Modal -->
<div id="teacherOptionsModal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
  <div class="modal-content bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 relative animate-fadeIn">
    <button id="closeTeacherOptionsModal"
      class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 hover:bg-red-500 hover:text-white transition">
      âœ•
    </button>
    <div class="text-center mb-5">
      <h3 class="text-xl font-semibold text-navy">
        <i class="fa-solid fa-user-tie text-accent"></i> Teacher ID Options
      </h3>
      <p class="text-sm text-gray-600 mt-1">Choose how you want to create teacher credentials.</p>
    </div>
    <div class="space-y-3">
      <button id="generateOneTeacherBtn" class="btn-primary w-full flex items-center justify-center gap-2 px-4 py-2 rounded-md">
        <i class="fa-solid fa-user-plus"></i> Generate One ID
      </button>
      <button id="openGenerateMultipleBtn" class="btn-secondary w-full flex items-center justify-center gap-2 px-4 py-2 rounded-md">
        <i class="fa-solid fa-users"></i> Generate Multiple IDs
      </button>
    </div>
  </div>
</div>


<!-- =============== END MODALS =============== -->


</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="{{ url_for('static', filename='js/ids.js') }}"></script>
{% endblock %}
